*** ActivityManagerService.smali	2013-11-18 12:21:24.362342430 +0800
--- ActivityManagerService.smali	2013-11-18 12:18:28.530339129 +0800
***************
*** 23,29 ****
          Lcom/android/server/am/ActivityManagerService$ProcessChangeItem;,
          Lcom/android/server/am/ActivityManagerService$Identity;,
          Lcom/android/server/am/ActivityManagerService$ForegroundToken;,
!         Lcom/android/server/am/ActivityManagerService$PendingActivityLaunch;
      }
  .end annotation
  
--- 23,30 ----
          Lcom/android/server/am/ActivityManagerService$ProcessChangeItem;,
          Lcom/android/server/am/ActivityManagerService$Identity;,
          Lcom/android/server/am/ActivityManagerService$ForegroundToken;,
!         Lcom/android/server/am/ActivityManagerService$PendingActivityLaunch;,
!         Lcom/android/server/am/ActivityManagerService$Injector;
      }
  .end annotation
  
***************
*** 39864,39879 ****
      .end local v23           #uss:Lcom/android/server/am/UserStartedState;
      :cond_2
      monitor-exit p0
  
      return-void
  
      .end local v17           #NP:I
      :catchall_0
      move-exception v2
  
      monitor-exit p0
!     :try_end_0
!     .catchall {:try_start_0 .. :try_end_0} :catchall_0
  
      throw v2
  .end method
--- 39906,39939 ----
      .end local v23           #uss:Lcom/android/server/am/UserStartedState;
      :cond_2
      monitor-exit p0
+     :try_end_0
+     .catchall {:try_start_0 .. :try_end_0} :catchall_0
+ 
+     move-object/from16 v0, p0
+ 
+     iget v2, v0, Lcom/android/server/am/ActivityManagerService;->mFactoryTest:I
+ 
+     const/4 v3, 0x1
+ 
+     if-eq v2, v3, :cond_miui_0
  
+     move-object/from16 v0, p0
+ 
+     iget-object v2, v0, Lcom/android/server/am/ActivityManagerService;->mContext:Landroid/content/Context;
+ 
+     invoke-static {v2}, Lcom/android/server/am/ExtraActivityManagerService;->finishBooting(Landroid/content/Context;)V
+ 
+     :cond_miui_0
      return-void
  
      .end local v17           #NP:I
      :catchall_0
      move-exception v2
  
+     :try_start_miui_0
      monitor-exit p0
!     :try_end_miui_0
!     .catchall {:try_start_miui_0 .. :try_end_miui_0} :catchall_0
  
      throw v2
  .end method
***************
*** 61803,61808 ****
  
      invoke-direct/range {v2 .. v16}, Lcom/android/server/am/ActivityManagerService;->broadcastIntentLocked(Lcom/android/server/am/ProcessRecord;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;Ljava/lang/String;ZZIII)I
  
      and-int/lit8 v2, v19, 0x4
  
      if-eqz v2, :cond_9
--- 61876,61895 ----
  
      invoke-direct/range {v2 .. v16}, Lcom/android/server/am/ActivityManagerService;->broadcastIntentLocked(Lcom/android/server/am/ProcessRecord;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;Ljava/lang/String;ZZIII)I
  
+     move-object/from16 v0, p0
+ 
+     iget-object v2, v0, Lcom/android/server/am/ActivityManagerService;->mContext:Landroid/content/Context;
+ 
+     move-object/from16 v0, p0
+ 
+     iget-object v3, v0, Lcom/android/server/am/ActivityManagerService;->mHandler:Landroid/os/Handler;
+ 
+     move/from16 v0, v19
+ 
+     move-object/from16 v1, v24
+ 
+     invoke-static {v0, v1, v2, v3}, Landroid/app/MiuiThemeHelper;->handleExtraConfigurationChanges(ILandroid/content/res/Configuration;Landroid/content/Context;Landroid/os/Handler;)V
+ 
      and-int/lit8 v2, v19, 0x4
  
      if-eqz v2, :cond_9
