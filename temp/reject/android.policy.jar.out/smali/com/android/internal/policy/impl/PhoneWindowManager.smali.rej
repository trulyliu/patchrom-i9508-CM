*** PhoneWindowManager.smali	2013-11-10 11:52:29.117671398 +0800
--- PhoneWindowManager.smali	2013-11-10 11:53:48.493673431 +0800
**************
*** 3961,3980 ****
  
      if-nez v2, :cond_5
  
-     move-object/from16 v0, p0
- 
-     iget v2, v0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mUnrestrictedScreenTop:I
- 
-     move-object/from16 v0, p0
- 
-     iget v3, v0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mStatusBarHeight:I
- 
-     add-int/2addr v2, v3
- 
-     move-object/from16 v0, p0
- 
-     iput v2, v0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mSystemTop:I
- 
      .end local v13           #navVisible:Z
      :cond_5
      return-void
--- 3974,3979 ----
  
      if-nez v2, :cond_5
  
      .end local v13           #navVisible:Z
      :cond_5
      return-void
***************
*** 5885,5895 ****
      move-result v6
  
      if-eqz v6, :cond_2
  
      or-int/lit8 v0, v0, 0x1
  
      :cond_2
      :goto_1
      iput-boolean v2, p0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mTopIsFullscreen:Z
  
      iget-object v6, p0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mKeyguard:Landroid/view/WindowManagerPolicy$WindowState;
--- 5896,5915 ----
      move-result v6
  
      if-eqz v6, :cond_2
+     
+     invoke-virtual {p0, v5}, Lcom/android/internal/policy/impl/PhoneWindowManager;->notifyStatusBarShowingOrHiding(Z)V
  
      or-int/lit8 v0, v0, 0x1
  
      :cond_2
      :goto_1
+     iget-object v6, p0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mStatusBar:Landroid/view/WindowManagerPolicy$WindowState;
+ 
+     if-eqz v6, :cond_miui_0
+     
+     invoke-static {p0}, Lcom/android/internal/policy/impl/PhoneWindowManager$Injector;->checkStatusBarVisibility(Lcom/android/internal/policy/impl/PhoneWindowManager;)V
+ 
+     :cond_miui_0 
      iput-boolean v2, p0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mTopIsFullscreen:Z
  
      iget-object v6, p0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mKeyguard:Landroid/view/WindowManagerPolicy$WindowState;
***************
*** 7782,7789 ****
      .end local v34           #telephonyService:Lcom/android/internal/telephony/ITelephony;
      :cond_5
      :goto_3
!     if-eqz v23, :cond_6
  
      const-string v3, "WindowManager"
  
      const-string v5, "Ignoring HOME; there\'s a ringing incoming call."
--- 7833,7851 ----
      .end local v34           #telephonyService:Lcom/android/internal/telephony/ITelephony;
      :cond_5
      :goto_3
!     if-eqz v23, :cond_miui_0
! 
!     move-object/from16 v0, p0
! 
!     iget-object v0, v0, Lcom/android/internal/policy/impl/PhoneWindowManager;->mContext:Landroid/content/Context;
! 
!     invoke-static {v0}, Lcom/android/internal/policy/impl/PhoneWindowManager$Injector;->isInCallScreenShowing(Landroid/content/Context;)Z
  
+     move-result v23
+ 
+     :cond_miui_0
+     if-eqz v23, :cond_6
+     
      const-string v3, "WindowManager"
  
      const-string v5, "Ignoring HOME; there\'s a ringing incoming call."
***************
*** 8814,8820 ****
  
      .local v6, isWakeKey:Z
      :goto_4
!     if-eqz v2, :cond_3
  
      move/from16 v0, p2
  
--- 8876,8882 ----
  
      .local v6, isWakeKey:Z
      :goto_4
!     invoke-static/range {p0 .. p2}, Lcom/android/internal/policy/impl/PhoneWindowManager$Injector;->performReleaseHapticFeedback(Lcom/android/internal/policy/impl/PhoneWindowManager;Landroid/view/KeyEvent;I)V
  
      move/from16 v0, p2
  
***************
*** 8830,8837 ****
  
      const/4 v12, 0x0
  
      const/4 v13, 0x1
  
      const/4 v14, 0x0
  
      invoke-virtual {p0, v12, v13, v14}, Lcom/android/internal/policy/impl/PhoneWindowManager;->performHapticFeedbackLw(Landroid/view/WindowManagerPolicy$WindowState;IZ)Z
--- 8892,8904 ----
  
      const/4 v12, 0x0
  
+     const/4 v13, 0x2
+     
+     if-eqz v2, :cond_miui_0
+ 
      const/4 v13, 0x1
  
+     :cond_miui_0
      const/4 v14, 0x0
  
      invoke-virtual {p0, v12, v13, v14}, Lcom/android/internal/policy/impl/PhoneWindowManager;->performHapticFeedbackLw(Landroid/view/WindowManagerPolicy$WindowState;IZ)Z

